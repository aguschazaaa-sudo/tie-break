name: Code Quality (Reusable)

on:
  workflow_call:

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'

      - name: Install dependencies
        run: flutter pub get

      - name: Install DCM (Dart Code Metrics)
        run: |
          dart pub global activate dart_code_metrics
          echo "$HOME/.pub-cache/bin" >> $GITHUB_PATH

      - name: Check unused code
        run: |
          echo "ðŸ” Unused Code Report" > unused-code-report.txt
          echo "=====================" >> unused-code-report.txt
          echo "" >> unused-code-report.txt
          dcm check-unused-code lib --no-fatal-unused >> unused-code-report.txt 2>&1 || echo "No unused code found or DCM error" >> unused-code-report.txt
          cat unused-code-report.txt
        continue-on-error: true

      - name: Check unused files
        run: |
          echo "ðŸ“„ Unused Files Report" > unused-files-report.txt
          echo "======================" >> unused-files-report.txt
          echo "" >> unused-files-report.txt
          dcm check-unused-files lib --no-fatal-unused >> unused-files-report.txt 2>&1 || echo "No unused files found or DCM error" >> unused-files-report.txt
          cat unused-files-report.txt
        continue-on-error: true

      - name: Upload code quality reports
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: code-quality-reports
          path: |
            unused-code-report.txt
            unused-files-report.txt
          retention-days: 30
